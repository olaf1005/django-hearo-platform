var bb_success,bb_error,bb_blackberryTimeout_id=-1;function handleBlackBerryLocationTimeout(){-1!=bb_blackberryTimeout_id&&bb_error({message:"Timeout error",code:3})}
function handleBlackBerryLocation(){clearTimeout(bb_blackberryTimeout_id);bb_blackberryTimeout_id=-1;if(bb_success&&bb_error){if(0==blackberry.location.latitude&&0==blackberry.location.longitude)bb_error({message:"Position unavailable",code:2});else{var a=null;blackberry.location.timestamp&&(a=new Date(blackberry.location.timestamp));bb_success({timestamp:a,coords:{latitude:blackberry.location.latitude,longitude:blackberry.location.longitude}})}bb_error=bb_success=null}}
var geo_position_js=function(){var a={},c=null;a.showMap=function(a,f){"undefined"!=typeof blackberry?blackberry.launch.newMap({latitude:1E5*a,longitude:1E5*-f}):window.location="http://maps.google.com/maps?q=loc:"+a+","+f};a.getCurrentPosition=function(a,f,e){c.getCurrentPosition(a,f,e)};a.init=function(){try{if("undefined"!=typeof geo_position_js_simulator)c=geo_position_js_simulator;else if("undefined"!=typeof bondi&&"undefined"!=typeof bondi.geolocation)c=bondi.geolocation;else if("undefined"!=
typeof navigator.geolocation)c=navigator.geolocation,a.getCurrentPosition=function(a,e,d){c.getCurrentPosition(function(b){"undefined"!=typeof b.latitude?a({timestamp:b.timestamp,coords:{latitude:b.latitude,longitude:b.longitude}}):a(b)},e,d)};else if("undefined"!=typeof window.blackberry&&blackberry.location.GPSSupported){if("undefined"==typeof blackberry.location.setAidMode)return!1;blackberry.location.setAidMode(2);a.getCurrentPosition=function(a,e,d){bb_success=a;bb_error=e;bb_blackberryTimeout_id=
d.timeout?setTimeout("handleBlackBerryLocationTimeout()",d.timeout):setTimeout("handleBlackBerryLocationTimeout()",6E4);blackberry.location.onLocationUpdate("handleBlackBerryLocation()");blackberry.location.refreshLocation()};c=blackberry.location}else"undefined"!=typeof window.google&&"undefined"!=typeof google.gears?(c=google.gears.factory.create("beta.geolocation"),a.getCurrentPosition=function(a,e,d){c.getCurrentPosition(function(b){"undefined"!=typeof b.latitude?a({timestamp:b.timestamp,coords:{latitude:b.latitude,
longitude:b.longitude}}):a(b)},e,d)}):"undefined"!=typeof Mojo&&"Mojo.Service.Request"!=typeof Mojo.Service.Request?(c=!0,a.getCurrentPosition=function(a,e,d){parameters={};if(d&&(d.enableHighAccuracy&&!0==d.enableHighAccuracy&&(parameters.accuracy=1),d.maximumAge&&(parameters.maximumAge=d.maximumAge),d.responseTime))5>d.responseTime?parameters.responseTime=1:20>d.responseTime?parameters.responseTime=2:parameters.timeout=3;r=new Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",
parameters:parameters,onSuccess:function(b){a({timestamp:b.timestamp,coords:{latitude:b.latitude,longitude:b.longitude,heading:b.heading}})},onFailure:function(a){1==a.errorCode?e({code:3,message:"Timeout"}):2==a.errorCode?e({code:2,message:"Position unavailable"}):e({code:0,message:"Unknown Error: webOS-code"+errorCode})}})}):"undefined"!=typeof device&&"undefined"!=typeof device.getServiceObject&&(c=device.getServiceObject("Service.Location","ILocation"),a.getCurrentPosition=function(a,e){c.ILocation.GetLocation({LocationInformationClass:"BasicLocationInformation"},
function(d,b,c){4==b?e({message:"Position unavailable",code:2}):a({timestamp:null,coords:{latitude:c.ReturnValue.Latitude,longitude:c.ReturnValue.Longitude,altitude:c.ReturnValue.Altitude,heading:c.ReturnValue.Heading}})})})}catch(g){return"undefined"!=typeof console&&console.log(g),!1}return null!=c};return a}();
